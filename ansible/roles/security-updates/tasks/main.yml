#SPDX-License-Identifier: MIT-0
---
# tasks file for security-updates
# roles/security-updates/tasks/main.yml

- name: Install unattended-upgrades
  apt:
    name:
      - unattended-upgrades
      - apt-listchanges
    state: present
    update_cache: yes

- name: Enable automatic security updates config
  copy:
    dest: /etc/apt/apt.conf.d/20auto-upgrades
    content: "{{ lookup('template', '20auto-upgrades.j2') }}"
    owner: root
    group: root
    mode: '0644'

- name: Configure unattended-upgrades
  template:
    src: 50unattended-upgrades.j2
    dest: /etc/apt/apt.conf.d/50unattended-upgrades
    owner: root
    group: root
    mode: '0644'

- name: Ensure unattended-upgrades is enabled
  command: dpkg-reconfigure --priority=low unattended-upgrades
  args:
    creates: /etc/apt/apt.conf.d/50unattended-upgrades

